# Telegram Bot

Telegram entry point for the Job Agent platform. The bot guides candidates through uploading their CV, kicks off the backend LangGraph workflows, and streams progress updates directly in chat.

## Capabilities

- `/upload` via PDF document upload to sanitize CVs through the PII removal workflow.
- `/search` command that orchestrates scraping, filtering, and processing jobs while reporting progress.
- `/status` and `/cancel` commands for monitoring or stopping long-running searches.
- Rich summaries of relevant jobs, including extracted skills generated by the backend workflows.

## Requirements

- Python 3.9 or newer.
- `TELEGRAM_BOT_TOKEN` from [@BotFather](https://t.me/botfather).
- Backend requirements satisfied for `job-agent-backend`, including `OPENAI_API_KEY`, database connectivity (`DATABASE_URL`), and any scrapper service credentials (see the backend README for details).
- Optional: Docker environment if you prefer containerized execution (`Dockerfile` and `entrypoint.sh` are provided).

## Installation

From the monorepo root:

```bash
pip install -e packages/job-agent-backend
pip install -e packages/telegram_bot
```

With development extras:

```bash
pip install -e "packages/telegram_bot[dev]"
```

## Configuration

Place required settings in a `.env` file at the repository root (loaded automatically by `main.py`):

```bash
TELEGRAM_BOT_TOKEN=123456:example-token-from-botfather
# Additional scrapper service variables as required by job-agent-backend
```

Ensure the database is migrated before running the bot. The provided Docker entrypoint runs Alembic migrations for you.

## Usage

```bash
python -m telegram_bot.main
```

After the bot starts:

1. Send your CV as a PDF document to store a sanitized copy for later searches.
2. Run `/search salary=5000 employment=remote days=7` (parameters are optional) to trigger the end-to-end pipeline.
3. Use `/status` to check progress or `/cancel` to stop the current search.

### Docker

```bash
cd packages/telegram_bot
docker build -t job-agent-telegram-bot .
docker run --env-file ../../.env job-agent-telegram-bot
```

The container entrypoint applies jobs-repository migrations before starting the bot.

## Project Layout

```
telegram_bot/
├── Dockerfile
├── entrypoint.sh
├── pyproject.toml
└── src/
    └── telegram_bot/
        ├── main.py
        ├── bot.py
        ├── di.py
        └── handlers/
            ├── start/
            ├── help/
            ├── search/
            ├── status/
            ├── cancel/
            └── upload_cv/
```

## Development

- `pytest` once tests are added (project scaffold is ready for it).
- `black src/` for formatting.
- `ruff check src/` for linting.
